#include "util.h"
#include <sega_per.h>
#include "file.h"

static int* textData;

int getLanguageNumber(void)
{
    int skip;
#ifdef JAPAN
    return 0;
#endif
    skip = 0;
    switch (systemMemory & PER_MSK_LANGU)
    {
        case PER_ENGLISH:
            skip = 0;
            break;
        case PER_ESPNOL:
            skip = 1;
            break;
        case PER_FRANCAIS:
            skip = 2;
            break;
        case PER_DEUTSCH:
            skip = 3;
            break;
    }
    return skip;
}

void loadLocalText(int fd)
{
    int size, skip;
    textData = mem_malloc(0, 7 * 1024);
    mem_lock();
    skip = getLanguageNumber();
    for (; skip >= 0; skip--)
    {
        fs_read(fd, (char*)&size, 4);

        size = FS_INT(&size);

        assert(size < 7 * 1024);
        fs_read(fd, (char*)textData, size);
    }
}

char* getText(int block, int string)
{
    char* addr;

    block = FS_INT(textData + block);
    block = FS_INT(textData + ((block >> 2) + string));

    addr = ((char*)textData) + block;
    return addr;
}
